---
import Link from '@/components/Link.astro'
import ThemeToggle from '@/components/ThemeToggle.astro'
import MobileMenu from '@/components/ui/mobile-menu'
import { NAV_LINKS, SITE } from '@/consts'
import Banner from '@/components/ui/banner.tsx'
import { type CollectionEntry, getCollection } from 'astro:content';
import { getAllPosts } from '@/lib/data-utils'
import MoreDropdown from '@/components/ui/more-dropdown.astro'

const { url } = Astro
const currentPath = url.pathname

const allPosts = await getAllPosts()
const latestPost = allPosts.length > 0 ? allPosts[0] : null
---

<header
  class="sticky top-0 left-0 w-full z-50 bg-background/50 backdrop-blur-lg"
  transition:persist
  >
  {latestPost && (
    <Banner
      client:only="react"
      type={`Latest post: `}
      text={`${latestPost.data.title}`}
      link={`/blog/${latestPost.id}`}
    />
  )}  
  <div
    class="mx-auto flex max-w-3xl items-center justify-between gap-4 px-4 py-2"
  >
    <Link href="/" class="flex shrink-0 items-center justify-center gap-2 group">
      <svg width="30" height="30" viewBox="0 0 30 30" class="size-6 group-hover:scale-125 transition-transform duration-300 ease-out">
        <circle cx="15" cy="15" r="15" fill="#6854ff" />
      </svg>
      <span class="hidden h-full text-lg font-medium min-[300px]:block group-hover:font-black transition-all duration-100 z-51"
        >{SITE.title}</span
      >
    </Link>
    <div class="flex items-center sm:gap-4 transition-all duration-300 ease-in-out">
      <nav class="hidden items-center gap-4 text-sm sm:flex sm:gap-6 transition-all duration-1000 ease-in-out">
        {
          NAV_LINKS.map((item) => (
            <Link
              href={item.href}
              class="text-foreground/60 hover:text-foreground/80 capitalize transition-colors"
            >
              {item.label}
            </Link>
          ))
        }
      </nav>
      <MobileMenu client:load transition:persist />
      <MoreDropdown />
      <ThemeToggle transition:persist />
    </div>
  </div>
</header>
